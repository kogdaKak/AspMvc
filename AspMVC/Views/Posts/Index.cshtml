@using static AspMVC.Scripts.Classes.Enums.PublicEnums
@model List<AspMVC.Models.Post>

@{
    ViewData["Title"] = "Лента постов";
    var pageSize = ViewBag.PageSize ?? 6; // Количество постов на страницу
}

<div class="container mt-4" id="postsContainer">
    <div class="row">
        @* Отображаем посты, пришедшие с сервера *@
        @foreach (var post in Model)
        {
            <div class="col-12 d-flex justify-content-center mb-4 post-card">
                <div class="card shadow-sm fixed-card">
                    @* Если есть картинка *@
                    @if (!string.IsNullOrEmpty(post.MediaUrl) && post.MediaType == MediaType.Image)
                    {
                        <img src="@post.MediaUrl" class="card-img-top fixed-media" />
                    }
                    @* Если есть видео *@
                    else if (!string.IsNullOrEmpty(post.MediaUrl) && post.MediaType == MediaType.Video)
                    {
                        <video controls preload="none" class="card-img-top fixed-media">
                            <source src="@post.MediaUrl" type="video/mp4" />
                            Ваш браузер не поддерживает видео.
                        </video>
                    }

                    <div class="card-body">
                        <p class="card-text">@post.Description</p>
                        @if (!string.IsNullOrEmpty(post.PubRuls))
                        {
                            <a href="@post.PubRuls" class="btn btn-primary source-link" target="_blank">Ссылка на источник</a>
                        }
                    </div>

                    <div class="card-footer text-muted">
                        @post.CreatedAt.ToString("g")
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@* Sentinel — элемент-наблюдатель внизу страницы *@
<div id="scrollSentinel" style="height: 1px;"></div>

@* Ссылка для теста *@
<p><a href="@Url.Action("Create", "Posts")">Создать тестовый пост</a></p>

@section Scripts {
    <script>
        // Передаём размер страницы из C# в JS
        window.pageSize = @pageSize;
    </script>
}
